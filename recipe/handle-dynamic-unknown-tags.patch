From f19b061c2761372d35eaaabceb779b7094474933 Mon Sep 17 00:00:00 2001
From: Charles Bousseau <cbousseau@anaconda.com>
Date: Wed, 27 Aug 2025 16:14:44 -0400
Subject: [PATCH] handle dynamic tags unknown to lief

---
 conda_build/os_utils/liefldd.py | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/conda_build/os_utils/liefldd.py b/conda_build/os_utils/liefldd.py
index 1279b3771a..79ae3fc07e 100644
--- a/conda_build/os_utils/liefldd.py
+++ b/conda_build/os_utils/liefldd.py
@@ -160,7 +160,9 @@ def get_libraries(file):
 
 
 def _get_elf_rpathy_thing(binary, attribute, dyn_tag):
-    dynamic_entries = binary.dynamic_entries
+    dynamic_entries = [
+        e for e in binary.dynamic_entries if isinstance(e, ELF_DYNAMIC_TAGS)
+    ]
     rpaths_colons = [getattr(e, attribute) for e in dynamic_entries if e.tag == dyn_tag]
     rpaths = []
     for rpath in rpaths_colons:
@@ -169,7 +171,9 @@ def _get_elf_rpathy_thing(binary, attribute, dyn_tag):
 
 
 def _set_elf_rpathy_thing(binary, old_matching, new_rpath, set_rpath, set_runpath):
-    dynamic_entries = binary.dynamic_entries
+    dynamic_entries = [
+        e for e in binary.dynamic_entries if isinstance(e, ELF_DYNAMIC_TAGS)
+    ]
     changed = False
     for e in dynamic_entries:
         if (
@@ -377,7 +381,9 @@ def get_uniqueness_key(filename, file):
     elif binary.format == EXE_FORMATS.ELF and (  # noqa
         binary.type == ELF32 or binary.type == ELF64
     ):
-        dynamic_entries = binary.dynamic_entries
+        dynamic_entries = [
+            e for e in binary.dynamic_entries if isinstance(e, ELF_DYNAMIC_TAGS)
+        ]
         result = [e.name for e in dynamic_entries if e.tag == ELF_DYNAMIC_TAGS.SONAME]
         if result:
             return result[0]
